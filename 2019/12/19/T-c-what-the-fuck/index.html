<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/hqweay/picbed/master/img/avatar/avatar.png"><link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/hqweay/picbed/master/img/avatar/avatar.png"><link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/hqweay/picbed/master/img/avatar/avatar.png"><link rel="mask-icon" href="https://raw.githubusercontent.com/hqweay/picbed/master/img/avatar/avatar.png" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"leay.net",root:"/",scheme:"Gemini",version:"7.7.2",exturl:!1,sidebar:{position:"left",display:"always",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"default"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!0,lazyload:!1,pangu:!1,comments:{style:"buttons",active:"valine",storage:!0,lazyload:!0,nav:{disqus:{text:"Load Disqus",order:-2},valine:{text:"Load Valine",order:-1}},activeClass:"valine"},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!0,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="TL;DR当初由于 ISO646 标准，部分国家的程序员打不出 {、} 等字符，所以 ANSI C 委员会引入了三元符。但三元符的使用可能会产生一些有趣的效果…… 测试效果gcc version ：gcc (GCC) 9.2.0 正文原文：C, what the fuck??!December 2019下面这段代码执行后，变量 a 的值应该是多少？123int a &#x3D; 0;&#x2F;&#x2F; What wil"><meta property="og:type" content="article"><meta property="og:title" content="译 - C, what the fuck??! - Robin Martijn"><meta property="og:url" content="https://leay.net/2019/12/19/T-c-what-the-fuck/index.html"><meta property="og:site_name" content="养恐龙"><meta property="og:description" content="TL;DR当初由于 ISO646 标准，部分国家的程序员打不出 {、} 等字符，所以 ANSI C 委员会引入了三元符。但三元符的使用可能会产生一些有趣的效果…… 测试效果gcc version ：gcc (GCC) 9.2.0 正文原文：C, what the fuck??!December 2019下面这段代码执行后，变量 a 的值应该是多少？123int a &#x3D; 0;&#x2F;&#x2F; What wil"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://leay.net/2019/12/19/T-c-what-the-fuck/img/2019-12-19-T-c-what-the-fuck/show.png"><meta property="og:image" content="https://leay.net/2019/12/19/T-c-what-the-fuck/img/2019-12-19-T-c-what-the-fuck/image-20211114154548480.png"><meta property="og:image" content="https://leay.net/2019/12/19/T-c-what-the-fuck/img/2019-12-19-T-c-what-the-fuck/image-20211114161003382.png"><meta property="article:published_time" content="2019-12-18T16:00:00.000Z"><meta property="article:modified_time" content="2023-01-15T15:37:32.138Z"><meta property="article:author" content="hqweay"><meta property="article:tag" content="翻译"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://leay.net/2019/12/19/T-c-what-the-fuck/img/2019-12-19-T-c-what-the-fuck/show.png"><link rel="canonical" href="https://leay.net/2019/12/19/T-c-what-the-fuck/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>译 - C, what the fuck??! - Robin Martijn | 养恐龙</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-9NQ5VKE0K9"></script><script>if(CONFIG.hostname===location.hostname){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9NQ5VKE0K9")}</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/feed.xml" title="养恐龙" type="application/atom+xml">
</head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">养恐龙</span> <span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="fa fa-fw fa-user-circle-o"></i>关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="site-search"><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></div></header><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://leay.net/2019/12/19/T-c-what-the-fuck/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://raw.githubusercontent.com/hqweay/picbed/master/img/avatar/avatar.png"><meta itemprop="name" content="hqweay"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="养恐龙"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">译 - C, what the fuck??! - Robin Martijn</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-12-19 00:00:00" itemprop="dateCreated datePublished" datetime="2019-12-19T00:00:00+08:00">2019-12-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-01-15 23:37:32" itemprop="dateModified" datetime="2023-01-15T23:37:32+08:00">2023-01-15</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%AD%A6%E4%B9%A0%E6%8A%98%E8%85%BE/" itemprop="url" rel="index"><span itemprop="name">学习折腾</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%AD%A6%E4%B9%A0%E6%8A%98%E8%85%BE/%E7%BF%BB%E8%AF%91/" itemprop="url" rel="index"><span itemprop="name">翻译</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="tldr"><a class="markdownIt-Anchor" href="#tldr"></a> TL;DR</h2><p>当初由于 ISO646 标准，部分国家的程序员打不出 <code>{</code>、<code>}</code> 等字符，所以 ANSI C 委员会引入了三元符。但三元符的使用可能会产生一些有趣的效果……</p><h2 id="测试效果"><a class="markdownIt-Anchor" href="#测试效果"></a> 测试效果</h2><p>gcc version ：gcc (GCC) 9.2.0</p><p><img src="/2019/12/19/T-c-what-the-fuck/img/2019-12-19-T-c-what-the-fuck/show.png" alt="show"></p><h2 id="正文"><a class="markdownIt-Anchor" href="#正文"></a> 正文</h2><p>原文：<a href="https://bowero.nl/blog/2019/12/15/c-what-the-fuck/" target="_blank" rel="noopener">C, what the fuck??!</a></p><p><em>December 2019</em></p><p>下面这段代码执行后，变量 <code>a</code> 的值应该是多少？</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// What will be the value of a????/</span></span><br><span class="line">a++;</span><br></pre></td></tr></table></figure><p>哈哈，既然我这样问了，你可能会觉得至少 <code>a</code> 的值不应该是 <code>1</code>。</p><p>实际上呢， <code>a</code> 的值仍然是 <code>0</code>，不会改变，因为 <code>a++;</code> 这行代码根本不会被执行。在 <code>a++;</code> 上面的那段注释里发生了些特殊的事情。</p><p>在讨论这个问题前，让我们先看看下面这个例子。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!didIMakeAMistake() ??!??! CIsWrongHere();</span><br></pre></td></tr></table></figure><p>首先，这段代码居然能能通过编译！这是咋回事？</p><p>要理解这个问题，首先要保证代码运行在现代版本的 <code>gcc</code> 环境并且开启了参数 <code>-trigraphs</code>（三元符）。 三元符是为了 <a href="https://www.gs1tw.org/twct/gs1w/download/DataMatrix_Character.pdf" target="_blank" rel="noopener">the ISO/IEC 646 Invariant character set</a> （ISO646 标准）中缺少的 9 个字符而发明的特殊字符组合。让我们看看 ISO646 标准中的字符。</p><p><img src="/2019/12/19/T-c-what-the-fuck/img/2019-12-19-T-c-what-the-fuck/image-20211114154548480.png" alt="image-20211114154548480"></p><p>Image: <a href="https://www.wikiwand.com/en/ISO/IEC_646" target="_blank" rel="noopener">Wikipedia</a></p><p>经常使用 C 的朋友应该一眼就看出这里缺少了哪 9 个字符吧，它们是这几个：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## \ ^ [ ] | &#123; &#125; ~</span><br></pre></td></tr></table></figure><p>有的朋友看了上面的表格可能会反倒感到困惑，哪儿缺少了，这 9 个字符不都在表格里吗？哈哈，注意一下，这 9 个字符都是灰色的，因为他们是各个国家的规则而不是国际规则。</p><p>有趣起来啦，让我们看个简单的例子：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; a[i] = <span class="string">'\n'</span>; &#125;</span><br></pre></td></tr></table></figure><p>上面这段简单的代码要是由一个瑞典程序员来写的话，可能是这样的：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä aÄiÜ = 'Ön'; ü</span><br></pre></td></tr></table></figure><p>为啥？因为他们那儿的字符规则里使用的字符和美国程序员不同嘛。</p><p>ANSI C 委员会自然也认识到这个问题了，于是它们决定引入三元符。用 9 种标准的字符组合来替换那些不标准的字符。</p><p><img src="/2019/12/19/T-c-what-the-fuck/img/2019-12-19-T-c-what-the-fuck/image-20211114161003382.png" alt="image-20211114161003382"></p><p>Image: <a href="https://en.wikipedia.org/wiki/Digraphs_and_trigraphs" target="_blank" rel="noopener">Wikipedia</a></p><p>这种解决方案当然不太优雅，但至少能用。</p><p>晓得了这些，我们再来看一下前面的几段代码。首先是后面那段简单点的：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!didIMakeAMistake() ??!??! CIsWrongHere();</span><br></pre></td></tr></table></figure><p>查看一下上面的表格，我们就知道这段代码里的 <code>??!</code> 实际上应该被取代为 <code>|</code>。因此这行代码的实际内容其实是：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!didIMakeAMistake() || CIsWrongHere();</span><br></pre></td></tr></table></figure><p>如果你理解 <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation" target="_blank" rel="noopener">short-circuit evaluation</a> （短路求值）是怎么工作的，那你就应该知道这行代码也可以表示为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (didIMakeAMistake())</span><br><span class="line">  CIsWrongHere();</span><br></pre></td></tr></table></figure><p>前面提到的第一个例子就更有趣啦，这也是一个我们为什么应该谨慎使用三元符的典例。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// What will be the value of a????/</span></span><br><span class="line">a++;</span><br></pre></td></tr></table></figure><p>上面已经说过啦，这段代码执行后，变量 <code>a</code> 的值实际上还是 <code>0</code>，因为 <code>a++;</code> 根本就不会被执行。</p><p>注意，只有当 <code>??</code> 后面跟随的字符在上面表格里的 9 个字符串里面，<code>??</code> 与该字符组成的字符串才会被识别为三元组。所以 C 预处理器将会把上面的代码处理为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// What will be the value of a??\</span></span><br><span class="line">a++;</span><br></pre></td></tr></table></figure><p>这里的 <code>\</code> 实际上是换行的转移符，所以这段代码实际上又相当于：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// What will be the value of a??a++;</span></span><br></pre></td></tr></table></figure><p>你瞧，这就是为什么 <code>a++;</code> 不会被执行。</p><p>I would like to end with a note from the committee itself:</p><blockquote><p>The Committee makes no claims that a program written using trigraphs looks attractive. As a matter of style, it may be wise to surround trigraphs with white space, so that they stand out better in program text. Some users may wish to define preprocessing macros for some or all of the trigraph sequences.</p><p><a href="http://www.open-std.org/jtc1/sc22/wg14/www/C99RationaleV5.10.pdf" target="_blank" rel="noopener">Rationale for International Standard Programming Languages C</a> (5.2.1.1)</p></blockquote></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E7%BF%BB%E8%AF%91/" rel="tag"># 翻译</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2019/12/18/manjaro/" rel="prev" title="Manjaro 个人新装配置"><i class="fa fa-chevron-left"></i> Manjaro 个人新装配置</a></div><div class="post-nav-item"><a href="/2019/12/25/hexo/" rel="next" title="Hexo 引用本地图片以及引用本地任意位置图片的一点思路">Hexo 引用本地图片以及引用本地任意位置图片的一点思路 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#tldr"><span class="nav-text">TL;DR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试效果"><span class="nav-text">测试效果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#正文"><span class="nav-text">正文</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="hqweay" src="https://raw.githubusercontent.com/hqweay/picbed/master/img/avatar/avatar.png"><p class="site-author-name" itemprop="name">hqweay</p></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">120</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">26</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/hqweay" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hqweay" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a> </span><span class="links-of-author-item"><a href="https://twitter.com/hqweay" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;hqweay" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i></a> </span><span class="links-of-author-item"><a href="mailto:hqweay@gmail.com" title="E-Mail → mailto:hqweay@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a> </span><span class="links-of-author-item"><a href="/feed.xml" title="RSS → &#x2F;feed.xml"><i class="fa fa-fw fa-rss"></i></a></span></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">hqweay</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div><span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script><script>window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://leay.net/2019/12/19/T-c-what-the-fuck/',]
      });
      });</script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '7iAyja9cBWOFGUdWkhMEzNgC-gzGzoHsz',
      appKey     : '54zRMCw7Os0qhRKiO6Xd1KK2',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});</script></body></html>